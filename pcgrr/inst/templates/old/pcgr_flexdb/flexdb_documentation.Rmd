
Settings & Docs
==================================================================

Row
-------------------------------------

### Settings and report configuration {data-padding=20}

```{r get_VEP_transcript_set, echo=F,results='asis'}

gencode_version <- 
  pcg_report$ref_data$metadata[pcg_report$ref_data$metadata$source_abbreviation == "gencode",]$source_version

#gencode_version <- gencode_versions[2]
if(pcg_report$settings$genome_assembly == "grch37"){
  gencode_version <- 19
}

transcript_set_gencode <- paste0("GENCODE - full transcript set (v", gencode_version,")")
if(as.logical(pcg_report$settings$conf$vep[['vep_gencode_basic']]) == T){
  transcript_set_gencode <- paste0("GENCODE - basic transcript set (v", gencode_version,")")
}

```

The report is generated with _[PCGR](https://github.com/sigven/pcgr)_  version `r pcg_report$settings$software$pcgr_version`.
<br><br>
Key report configuration settings:

* Genome assembly: <b> __`r pcg_report$settings$genome_assembly`__ </b>
* Minimum sequencing depth <b>tumor</b> (DP, SNV/InDel): <b> __`r pcg_report$settings$conf$somatic_snv$allelic_support$tumor_dp_min`__ </b>
* Minimum allelic fraction <b>tumor</b> (VAF, SNV/InDel): <b> __`r pcg_report$settings$conf$somatic_snv$allelic_support$tumor_af_min`__ </b>
* Minimum sequencing depth <b>control</b> (DP, SNV/InDel): <b> __`r pcg_report$settings$conf$somatic_snv$allelic_support$control_dp_min`__ </b>
* Maximum allelic fraction <b>control</b> (VAF, SNV/InDel): <b> __`r pcg_report$settings$conf$somatic_snv$allelic_support$control_af_max`__ </b>
* Tier system (VCF): __pcgr_acmg__
* Show noncoding variants: __`r pcg_report$settings$conf$other$show_noncoding`__
* MSI prediction: <b> __`r msi_prediction`__ </b>
* Mutational burden estimation: <b> __`r mutational_burden`__ </b>
  * TMB estimate shown in report: <b> __TMB_`r pcg_report$settings$conf$somatic_snv$tmb$tmb_display`__ </b>
* Mutational signatures estimation: <b> __`r signatures_estimation`__ </b>
  * Minimum number of mutations required: __`r pcg_report$settings$conf$somatic_snv$mutational_signatures$mutation_limit`__
  * All reference signatures: <b> __`r as.logical(pcg_report$settings$conf$somatic_snv$mutational_signatures$all_reference_signatures)`__ </b>
  * Inclusion of artefact signatures: <b> __`r as.logical(pcg_report$settings$conf$somatic_snv$mutational_signatures$include_artefact_signatures)`__ </b>
  * Minimum tumor-type prevalence (percent) of reference signatures used for refitting: <b> __`r pcg_report$settings$conf$somatic_snv$mutational_signatures$prevalence_reference_signatures`__</b>
* Clinical trial inclusion: <b> __`r trial_inclusion`__ </b>
* Variant Effect Predictor (VEP) settings:
  * Buffer size: __`r pcg_report$settings$conf$vep$vep_buffer_size`__
  * Transcript set: __`r transcript_set_gencode`__
  * Transcript pick order: __`r stringr::str_replace_all(pcg_report$settings$conf$vep$vep_pick_order,",",", ")`__
  * Regulatory regions annotation: __`r as.logical(pcg_report$settings$conf$vep$vep_regulatory)`__


### Sample and sequencing assay information {data-padding=20}

* Assay sequencing type (VCF): <b> __`r pcg_report$settings$conf$assay_properties$type`__ </b>
* Assay coding target size (VCF): <b> __`r pcg_report$settings$conf$assay_properties$effective_target_size_mb` Mb__ </b>
* Assay sequencing mode (VCF): <b> __`r pcg_report$settings$conf$assay_properties$mode`__ </b>

<br>

* Tumor sample - primary site: <b> __`r pcg_report$settings$conf$sample_properties$site`__ </b>
* Tumor sample - purity: <b> __`r pcg_report$settings$conf$sample_properties$purity`__ </b>
* Tumor sample - ploidy: <b> __`r pcg_report$settings$conf$sample_properties$ploidy`__ </b>

<br>

### Documentaton - report data sources {data-padding=20}

The report generated with PCGR is based on the following underlying tools and knowledge resources:

* __PCGR reference data version__
  
  * __`r pcg_report$settings$reference_data$version`__

* __Databases/datasets__ 
```{r list_db, echo=F,results='asis'}
i <- 1
ref_datasets <- pcg_report$ref_data$metadata
for(i in 1:NROW(ref_datasets)){
  source_full <- ref_datasets[i,"source"]
  source <- ref_datasets[i,"source_abbreviation"]
  description <- ref_datasets[i,"source_description"]
  url <- ref_datasets[i,"source_url"]
  version <- ref_datasets[i,"source_version"]
  if(version == "."){
    version = NA
  }
  license <- ref_datasets[i, "source_license"]
  license_url <- ref_datasets[i, "source_license_url"]
  if(license_url == "."){
    license_url <- NA
  }
  wflow <- ref_datasets[i, "wflow"]
  if(!(stringr::str_detect(
    wflow,"pcgr"))){
    next
  }
  
  s <- ""
  if(is.na(version)){
    if(!is.na(license_url)){
      s <- paste0("    * [", source_full, "](", url, ") - ", description, " - [",
                  license,"](", license_url, ")")
    }else{
      s <- paste0("    * [", source_full, "](", url, ") - ", description, " - ",
                  license)
    }
  }else{
    if(!is.na(license_url)){
      if(source == "cgc" | source == "gepa"){
        s <- paste0("    * [", source_full, "](", url, ") - ", description, " (<b>", version, "</b>)",
                    " - <b>[", license,"](", license_url, ")</b>")
      }else{
        s <- paste0("    * [", source_full, "](", url, ") - ", description, " (<b>", version, "</b>)",
                    " - [", license,"](", license_url, ")")
      }
    }else{
       s <- paste0("    * [", source_full, "](", url, ") - ", description, " (<b>", version, "</b>)",
                  " - ", license)
    }
  }
  if(s != ""){
    cat(s, sep = "\n")
  }
}

```


Row
-------------------------------------

### Documentation - report content {data-padding=20}

#### SNVs/InDels

The prioritization of SNV and InDels found in the tumor sample is done according to a four-tiered structure, adopting the joint consensus recommendation by AMP/ACMG [Li et al., 2017](https://www.ncbi.nlm.nih.gov/pubmed/27993330).

- [**TIER 1: Variants of strong clinical significance**](#tier-1) - constitutes variants linked to predictive, prognostic, or diagnostic biomarkers in the [CIViC database](http://civic.genome.wustl.edu) and the [Cancer Biomarkers Database](https://www.cancergenomeinterpreter.org/biomarkers) that are
	 - Found within the same tumor type/class as specified by the user, **AND**
	 - Of strong clinical evidence (i.e. part of guidelines, validated or discovered in late clinical trials ([CIViC evidence levels A/B](https://civic.readthedocs.io/en/latest/model/evidence/level.html)))
	 
 - [**TIER 2: Variants of potential clinical significance**](#tier-2) - constitutes other variants linked to predictive, prognostic, or diagnostic biomarkers in the [CIViC database](http://civic.genome.wustl.edu) and the [Cancer Biomarkers Database](https://www.cancergenomeinterpreter.org/biomarkers) that are either
	 - Of strong clinical evidence in other tumor types/classes than the one specified by the user, **OR**
	 - Of weak clinical evidence (early trials, case reports etc. ([CIViC evidence levels C/D/E](https://civic.readthedocs.io/en/latest/model/evidence/level.html)))) in the same tumor type/class as specified by the user
	 
 - [**TIER 3: Variants of uncertain clinical significance**](#tier-3) - includes other coding variants found in oncogenes or tumor suppressor genes
   - Genes are annotated as oncogenes and/or tumor suppressors genes if they
       i) have an associated record in curated databases ([Network of Cancer Genes (NCG)](http://ncg.kcl.ac.uk/)/[Cancer Gene Census](https://www.sanger.ac.uk/data/cancer-gene-census/)), **OR**,
       ii) have evidence from high-throughput literature mining (at least 20 publications, as collected from the [CancerMine text-mining resource](http://bionlp.bcgsc.ca/cancermine/)) 
     
 - [**TIER 4**](#tier-4) - includes other protein-coding variants
     - <i>Protein-coding</i> refers here to variants with the following consequences: 
      - missense_variant
      - stop_gain/stop_loss
      - frameshift_variant
      - inframe_insertions/inframe_deletions
      - splice_donor_variant/splice_acceptor_variant
      - start_loss
 - [**TIER 5**](#tier-5) - includes other non-(protein)coding variants
 
A complete list of reported biomarkers that associate with variants in the tumor sample (not necessarily qualifying for assignment to TIER 1/TIER 2) is also shown in a separate section.

#### Somatic copy number aberrations

Somatic copy number aberrations identified in the tumor sample are classified into **two main tiers**:

- [**TIER 1: Aberrations of strong clinical significance**](#tier-1-1) - constitutes amplified/lost genes linked to predictive, prognostic, or diagnostic biomarkers in the [CIViC database](http://civic.genome.wustl.edu) and the [Cancer Biomarkers Database](https://www.cancergenomeinterpreter.org/biomarkers) that are
	 - Found within the same tumor type/class as specified by the user, **AND**
	 - Of strong clinical evidence (i.e. part of guidelines, validated or discovered in late clinical trials ([CIViC evidence levels A/B](https://civic.readthedocs.io/en/latest/model/evidence/level.html)))
	 - overlap between variants in the tumor sample and reported biomarkers must occur at the _exact variant level_ or at the _codon/exon level_
	 	 
- [**TIER 2: Aberrations of potential clinical significance**](#tier-2-1) - constitutes amplified/lost genes linked to predictive, prognostic, or diagnostic biomarkers in the [CIViC database](http://civic.genome.wustl.edu) and the [Cancer Biomarkers Database](https://www.cancergenomeinterpreter.org/biomarkers) that are either
	 - Of strong clinical evidence in other tumor types/classes than the one specified by the user, **OR**
	 - Of weak clinical evidence (early trials, case reports etc. ([CIViC evidence levels C/D/E](https://civic.readthedocs.io/en/latest/model/evidence/level.html)))) in the same tumor type/class as specified by the user
	 
Included in the report is also a complete list of [**all oncogenes subject to amplifications**](#scna-oncogene), [**tumor suppressor genes subject to homozygous deletions**](#scna-tsgene), and [**other drug targets subject to amplifications**](#scna-other)

#### Mutational signatures

The set of somatic mutations observed in a tumor reflects the varied mutational processes that have been active during its life history, providing insights into the routes taken to carcinogenesis. Exogenous mutagens, such as tobacco smoke and ultraviolet light, and endogenous processes, such as APOBEC enzymatic family functional activity or DNA mismatch repair deficiency, result in characteristic patterns of mutation. Mutational signatures can have significant clinical impact in certain tumor types ([Póti et al., 2019](https://www.ncbi.nlm.nih.gov/pubmed/31727117), [Ma et al., 2018](https://www.ncbi.nlm.nih.gov/pubmed/30120226))

The **MutationalPatterns** package ([Blokzijl et al., 2018](https://www.ncbi.nlm.nih.gov/pubmed/29695279)) is used to estimate the relative contribution of known mutational signatures in a single tumor sample. [MutationalPatterns](https://github.com/UMCUGenetics/MutationalPatterns) makes an optimal reconstruction of the mutations observed in a given sample with a [COSMIC's (v3.4) reference collection of n = 86 mutational signatures (SBS, including sequencing artefacts)](https://cancer.sanger.ac.uk/signatures/sbs/). By default, we restrict the signatures in the reference collection to those already observed in the tumor type in question (i.e. from large-scale <i>de novo</i> signature extraction on ICGC-PCAWG tumor samples). 

```{r results = "asis", eval = pcg_report$content$mutational_signatures$eval & !pcg_report$content$mutational_signatures$missing_data}

cat("Specifically, for tumors of type <b>", pcg_report$settings$conf$sample_properties$site,"</b>, mutational signature reconstruction is limited to the following reference collection:",sep="\n")

dat <- pcg_report$content$mutational_signatures$result$reference_data
if("SIGNATURE_ID" %in% colnames(dat) & 
   "AETIOLOGY_KEYWORD" %in% colnames(dat) & 
   NROW(dat) > 0){
  cat('<ul>')
  i <- 1
  
  refsig_collection_site <- pcg_report$content$mutational_signatures$result$reference_data |>
    dplyr::mutate(tmp_id = as.numeric(
      stringr::str_replace(
        stringr::str_replace(
          stringr::str_replace(
            stringr::str_replace(
              stringr::str_replace(SIGNATURE_ID,"SBS",""),
              "a",".2"),
            "b",".4"),
          "c", ".6"),
        "d",".8"))) |>
    dplyr::arrange(tmp_id) |>
    dplyr::select(SIGNATURE_ID, AETIOLOGY_KEYWORD) |>
    dplyr::distinct()
  
  while(i <= nrow(refsig_collection_site)){
    cat(paste0("<li><b>",refsig_collection_site[i,]$SIGNATURE_ID, "</b> - ", refsig_collection_site[i,]$AETIOLOGY_KEYWORD),'</li>\n')
    i <- i + 1
  }
  cat('</ul>')
}

cat("<br>")

if(pcg_report$settings$conf$somatic_snv$mutational_signatures$all_reference_signatures == T){
  cat("<b>NOTE:</b> Option <i>'--all_reference_signatures'</i> have been applied for this query, which means that all reference signatures (n = 67) have been considered during optimal reconstruction of the mutational profile with reference signatures",sep="\n")
}

if(pcg_report$settings$conf$somatic_snv$mutational_signatures$include_artefact_signatures == T){
  cat("<b>NOTE:</b> Option '--include_artefact_signatures' have been applied for this query, which means that also signatures attributed to e.g. sequencing artefacts have been considered during optimal reconstruction of the mutational profile with reference signatures",sep="\n")
}
```   

```{r missing_data, results = "asis", eval = pcg_report$content$mutational_signatures$eval == T & pcg_report$content$mutational_signatures$missing_data}
cat("<b>NOTE</b>: This sample contains too few variants for estimation of mutational signature contributions",sep="\n")
```
```{r signature_fit, results = "asis", eval = pcg_report$content$mutational_signatures$eval == T & !pcg_report$content$mutational_signatures$missing_data}
cat("The accuracy of signature fitting (highlighted in value box) reflects how well the mutational profile can be reconstructed with signatures from the reference collection. Reconstructions with fitting accuracy below 90% should be interpreted with caution.",sep="\n")
```

#### Tumor mutational burden (TMB)

Tumor mutational load or mutational burden is a measure of the number of mutations within a tumor genome, defined as the total number of mutations per coding area of a tumour genome. TMB serves as a proxy for the number of neoantigens generated per tumor, which in turn is correlated to immunotherapy response. For estimation of TMB, PCGR employs two different algorithms (one to be chosen by the user):

  1) **TMB_all_coding**: the same approach as was outlined in a large-scale study of TMB ([Chalmers et al., 2017](https://www.ncbi.nlm.nih.gov/pubmed/28420421)), i.e. counting all somatic base substitutions and indels in the protein-coding regions of the sequencing assay, including synonymous alterations. 
  2) **TMB_missense_only**: missense/non-synonymous variants only, i.e. as employed by [Fernandez et al., 2019](https://www.ncbi.nlm.nih.gov/pubmed/31475242)

Numbers obtained with 1) or 2) is next divided by the effective (coding) target size of the sequencing assay, which can be provided by the user (defaults to 34Mb, approximate coding target size of GENCODE gene set).


#### MSI classification

Microsatellite instability (MSI) is the result of impaired DNA mismatch repair and constitutes a cellular phenotype of clinical significance in many cancer types, most prominently colorectal cancers, stomach cancers, endometrial cancers, and ovarian cancers ([Cortes-Ciriano et al., 2017](https://www.ncbi.nlm.nih.gov/pubmed/28585546)). We have built a statistical MSI classifier from somatic mutation profiles that separates _MSI.H_ (MSI-high) from _MSS_ (MS stable) tumors. The MSI classifier was trained using 999 exome-sequenced TCGA tumor samples with known MSI status (i.e. assayed from mononucleotide markers), and obtained a [positive predictive value](https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values#Positive_predictive_value) of 100% and a [negative predictive value](https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values#Negative_predictive_value) of 99.4% on an independent test set of 427 samples. Details of the MSI classification approach can be found <a href="https://rpubs.com/sigven/msi2020_v2" target="_blank">here</a>.

Note that the MSI classifier is applied only for WGS/WES tumor-control sequencing assays.

#### Kataegis

Kataegis describes a pattern of localized hypermutations identified in some cancer genomes, in which a large number of highly-patterned basepair mutations occur in a small region of DNA (ref Wikipedia). Kataegis is prevalently seen among breast cancer patients, and it also exists in lung cancers, cervical, head and neck, and bladder cancers, as shown in the results from tracing APOBEC mutation signatures (ref Wikipedia). PCGR implements the kataegis detection algorithm outlined in the [KataegisPortal R package](https://github.com/MeichunCai/KataegisPortal), applied in the study by [Yin et al. (2020)](https://pubmed.ncbi.nlm.nih.gov/31862729/). 

Explanation of key columns in the resulting table of potential kataegis events: 

* __weight.C>X__: proportion of C>X mutations
* __confidence__: confidence degree of potential kataegis events (range: 0 to 3)
    - 0 - a hypermutation with weight.C>X < 0.8; 
    - 1 - one hypermutation with weight.C>X >= 0.8 in a chromosome; 
    - 2 - two hypermutations with weight.C>X >= 0.8 in a chromosome; 
    - 3 - high confidence with three or more hypermutations with weight.C>X >= 0.8 in a chromosome)

#### Germline findings

For PCGR reports that are fueled with CPSR report contents (JSON), we here list the main findings from the CPSR report, i.e. the collection of __Pathogenic/Likely Pathogenic/VUS variants__ (ClinVar and novel CPSR-classified variants). We also show whether any of the query variants are associated with established biomarker evidence items with respect to cancer predisposition, prognosis, therapeutic regimens etc.

#### Clinical trials

Each report is provided with a list of trials for the tumor type in question, where we limit the trials listed to ongoing or forthcoming trials with a "molecular focus" (presence of molecular biomarkers in inclusion criteria, targeted drugs as interventions etc.). Recognition of biomarkers in trials is conducted through an in-house text mining procedure. 

Note that the trials have currently not been subject to any matching with respect to the molecular profile of the tumor, trials are thus basically unprioritized, and have to be explored interactively by the user in order to discover relevant trials. 

#### References

